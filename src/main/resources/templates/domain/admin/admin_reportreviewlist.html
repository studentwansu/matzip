<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>신고된 리뷰 조회 페이지</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poor+Story&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style_admin.css">
  <link rel="stylesheet" href="/css/header_footer.css">
</head>
<body>
<!-- 헤더 영역 (기존 헤더 프래그먼트 사용) -->
<div th:replace="~{html/admin_header :: adminHeader}"></div>

<!-- 콘텐츠 래퍼 -->
<div class="container">
  <!-- 사이드바 (기존 사이드바 프래그먼트 사용) -->
  <div th:replace="~{html/admin_sidebar :: adminSidebar}"></div>

  <!-- 메인 컨텐츠 -->
  <main>
    <h2>신고된 리뷰 목록</h2>

    <!-- 필터 및 검색 폼 -->
    <form id="filterForm" th:action="@{/admin/admin_revreportlist}" method="get">
      <div class="filter-controls">
        <span>신고 횟수 필터:</span>
        <input type="number" name="reportCountThreshold" th:value="${criteria.reportCountThreshold}" min="1" style="width: 60px;">

        <label>
          <input type="checkbox" name="unprocessed" value="true" th:checked="${criteria.unprocessed}"> 미처리
        </label>
        <label>
          <input type="checkbox" name="processed" value="true" th:checked="${criteria.processed}"> 처리
        </label>

        <input type="text" name="userId" th:value="${criteria.userId}" placeholder="작성자 ID 검색">

        <button type="submit">검색</button>
      </div>
    </form>

    <!-- 신고된 리뷰 통계/개요 -->
    <div class="review-summary">
      <p>
        처리되지 않은 리뷰 <b th:text="${unprocessedCount}">0</b>건 /
        처리된 리뷰 <b th:text="${processedCount}">0</b>건
      </p>
    </div>

    <!-- 테이블 목록 -->
    <table class="review-list">
      <thead>
      <tr>
        <th>리뷰 코드</th>
        <th>작성자 ID</th>
        <th>신고 횟수</th>
        <th>리뷰 내용</th>
        <th>처리 상태</th>
        <th>작성일</th>
      </tr>
      </thead>
      <tbody>
      <!-- 리뷰가 없을 경우 -->
      <tr th:if="${reviews.isEmpty()}">
        <td colspan="6" style="text-align: center;">신고된 리뷰가 없습니다.</td>
      </tr>
      <!-- 리뷰 반복 구간 -->
      <tr th:each="review : ${reviews}">
        <td th:text="${review.reviewCode}">999</td>
        <td th:text="${review.userId}">user99</td>
        <td th:text="${review.reviewReportCount}">99</td>
        <td>
          <!-- 리뷰 상세 페이지로 이동하는 링크 -->
          <a th:href="@{/admin/report/review/{reviewCode}(reviewCode=${review.reviewCode})}" th:text="${#strings.abbreviate(review.reviewContent, 30)}">
            리뷰 내용...
          </a>
        </td>
        <td>
          <!-- 처리 상태에 따라 다른 텍스트 표시 -->
          <span th:if="${review.hiddenFlag == 0}" style="color: red;">미처리</span>
          <span th:if="${review.hiddenFlag == 1}" style="color: green;">처리 완료</span>
        </td>
        <td th:text="${#temporals.format(review.reviewDate, 'yyyy-MM-dd')}">2025-10-28</td>
      </tr>
      </tbody>
    </table>

    <!-- 페이지네이션 -->
    <div class="pagination" th:if="${!reviews.isEmpty()}">
      <!-- 이전 페이지 -->
      <a th:if="${reviews.hasPrevious()}"
         th:href="@{/admin/admin_revreportlist(page=${reviews.number}, reportCountThreshold=${criteria.reportCountThreshold}, unprocessed=${criteria.unprocessed}, processed=${criteria.processed}, userId=${criteria.userId})}">
        &lt;
      </a>

      <!-- 페이지 번호 -->
      <span th:each="pageNum : ${#numbers.sequence(0, reviews.totalPages - 1)}">
                <a th:if="${pageNum != reviews.number}"
                   th:href="@{/admin/admin_revreportlist(page=${pageNum + 1}, reportCountThreshold=${criteria.reportCountThreshold}, unprocessed=${criteria.unprocessed}, processed=${criteria.processed}, userId=${criteria.userId})}"
                   th:text="${pageNum + 1}"></a>
                <strong th:if="${pageNum == reviews.number}" th:text="${pageNum + 1}"></strong>
            </span>

      <!-- 다음 페이지 -->
      <a th:if="${reviews.hasNext()}"
         th:href="@{/admin/admin_revreportlist(page=${reviews.number + 2}, reportCountThreshold=${criteria.reportCountThreshold}, unprocessed=${criteria.unprocessed}, processed=${criteria.processed}, userId=${criteria.userId})}">
        &gt;
      </a>
    </div>
  </main>
</div>

<!-- 푸터 (기존 푸터 프래그먼트 사용) -->
<div th:replace="~{html/admin_footer :: adminFooter}"></div>
</body>
</html>