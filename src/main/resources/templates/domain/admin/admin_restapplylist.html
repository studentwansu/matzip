<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ê´€ë¦¬ì ë“±ë¡ì‹ ì²­ëª©ë¡í˜ì´ì§€</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poor+Story&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style_admin.css">
</head>
<body>
    <header>
        <section class="admin-header">
            <a href="">
                <img class="logo" src="/static/img/logo.png">
            </a>
            <div class="admin-header-container">
                <div class="admin-header-textdiv">
                    <p class="admin-header-font1"> ì–´ì©Œêµ¬ì €ì©Œêµ¬ </p>
                    <div class="line-yellow"></div>
                    <p class="admin-header-font2"> ì–´ì©Œêµ¬ì €ì©Œêµ¬</p>
                </div>
            </div>
            <div class="logout">
                <p class="navi-font">ê´€ë¦¬ìë‹˜, í™˜ì˜í•©ë‹ˆë‹¤. ğŸ˜Š</p>
                <a href="">
                    <button class="redbutton3 redbutton-font">
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </a>
            </div>
        </section>
    </header>

    <main>
        <section class="body-section">
            <div class="navi">
                <div class="redbutton">
                    <span class="redbutton-font">ë§ˆì´í˜ì´ì§€</span>
                </div>
                <ul>
                    <li><a href="" class="navi-font">ì‹ë‹¹ ë“±ë¡ ì‹ ì²­ ì¡°íšŒ</a></li>
                    <li><a href="" class="navi-font">ì‹ë‹¹ ì •ë³´ ìˆ˜ì • ìš”ì²­ ì¡°íšŒ</a></li>
                    <li><a href="" class="navi-font">ì‹ ê³  ë¦¬ë·° ì¡°íšŒ</a></li>
                    <li><a href="" class="navi-font">ì‹ ê³ ëœ ìœ ì € ê³„ì • ì¡°íšŒ</a></li>
                    <li><a href="" class="navi-font">ê³µì§€ì‚¬í•­</a></li>
                    <li><a href="" class="navi-font">FAQ(ìì£¼ ë¬»ëŠ” ì§ˆë¬¸)</a></li>
                    <li><a href="" class="navi-font">ë¬¸ì˜ì‚¬í•­</a></li>
                    <li><a href="" class="navi-font">ì‹ë‹¹ ëª©ë¡ ì¡°íšŒ</a></li>
                </ul>
            </div>
            <div class="container-section">
                <div class="container-search">
                    <div class="container-search2 navi-font">
                        <label>
                            <input class="custom-input" type="checkbox" id="sortDate" name="sort">
                            ì‹ ì²­ì¼ ìˆœìœ¼ë¡œ ì •ë ¬
                        </label>
                        <label>
                            <input class="custom-input" type="checkbox" id="sortName" name="sort">
                            ì‹ë‹¹ëª… ìˆœìœ¼ë¡œ ì •ë ¬
                        </label>

                    </div>
                    <div class="container-search3">
                        <input class="admin-input-long navi-font" type="text" id="keyword" name="keyword" placeholder="ì‹ë‹¹ëª… ë° í‚¤ì›Œë“œ ê²€ìƒ‰">
                        <button class="redbutton redbutton-font">ê²€ìƒ‰</button>
                    </div>

                </div>
                <div class="container-storelist">
                    <div class="container-title">
                        <span class="container-font1">ë“±ë¡ ì‹ ì²­í•œ ì‹ë‹¹ 10ê°œ</span>
                        <p class="container-font2 ">ì‹ ì²­ ë²ˆí˜¸</p>
                    </div>
                    <div class="line-yellow"></div>
                    <table class="table-class">
                        <thead>
                        <tr>
                            <th>ì•¡ì…˜</th>
                            <th>ì‹ë‹¹ ì •ë³´</th>
                            <th>ì‹ ì²­ ë²ˆí˜¸</th>
                        </tr>
                        </thead>
                        <tbody id="restaurant-table-body">
                        <!-- JSê°€ ì—¬ê¸°ë‹¤ <tr>ë“¤ì„ ë„£ì–´ì¤„ ê±°ì˜ˆìš” -->
                        </tbody>
                    </table>

                    </table>
                </div>

                </div>
            </div>
        </div>
    </section>
    </main>

    <footer>
        <p class="footer-font">Copyright 2025 ë§›zip All Right Reserved</p>
        <!-- <ul>
            <li class="footer-font"><a href="">ê³µì§€ì‚¬í•­</a></li>
            <li class="footer-font"><a href="">FAQ</a></li>
            <li class="footer-font"><a href="">Q&A</a></li>
        </ul> -->
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sortDateCb = document.getElementById('sortDate');
            const sortNameCb = document.getElementById('sortName');

            // ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ ì„œë¡œ ë°°íƒ€ì ìœ¼ë¡œ ë™ì‘ì‹œí‚¤ê³ , ë¡œë“œ ì¬í˜¸ì¶œ
            sortDateCb.addEventListener('change', () => {
                if (sortDateCb.checked) {
                    sortNameCb.checked = false;
                    loadPendingRestaurants('date');
                } else {
                    loadPendingRestaurants();  // ê¸°ë³¸ ì •ë ¬
                }
            });
            sortNameCb.addEventListener('change', () => {
                if (sortNameCb.checked) {
                    sortDateCb.checked = false;
                    loadPendingRestaurants('name');
                } else {
                    loadPendingRestaurants();  // ê¸°ë³¸ ì •ë ¬
                }
            });

            // ì´ˆê¸° ë¡œë“œ (ê¸°ë³¸ ì •ë ¬)
            loadPendingRestaurants();
        });

        function loadPendingRestaurants(sortBy) {
            fetch('/admin/restaurants/pending')
                .then(res => res.json())
                .then(data => {
                    // 1) í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì •ë ¬
                    if (sortBy === 'date') {
                        // ìµœì‹  ì‹ ì²­ì¼ ìˆœ (ë‚´ë¦¼ì°¨ìˆœ)
                        data.sort((a, b) =>
                            new Date(b.restaurantRegistrationDate) - new Date(a.restaurantRegistrationDate)
                        );
                    } else if (sortBy === 'name') {
                        // ì‹ë‹¹ëª… ì˜¤ë¦„ì°¨ìˆœ
                        data.sort((a, b) =>
                            a.restaurantName.localeCompare(b.restaurantName)
                        );
                    }
                    renderTable(data);
                })
                .catch(console.error);
        }

        function renderTable(data) {
            const tbody = document.getElementById('restaurant-table-body');
            tbody.innerHTML = '';
            data.forEach(r => {
                const tr = document.createElement('tr');
                // ì•¡ì…˜
                const tdAct = document.createElement('td');
                tdAct.style.width = '1vh';
                tdAct.innerHTML = `
      <button class="redbutton4" onclick="handleApprove(${r.restaurantCode})">ìˆ˜ë½</button>
      <button class="redbutton4" onclick="handleReject(${r.restaurantCode})">ë°˜ë ¤</button>
    `;
                tr.appendChild(tdAct);
                // ì •ë³´
                const tdInfo = document.createElement('td');
                tdInfo.style.textAlign = 'left';
                let info = `${r.restaurantName}<br>ì‹ ì²­ì¼ : ${formatDate(r.restaurantRegistrationDate)}<br>`;
                if (r.restaurantStatus === 2 && r.rejectionDate) {
                    info += `ë°˜ë ¤ì¼ : ${formatDate(r.rejectionDate)}<br>`;
                }
                tdInfo.innerHTML = info;
                tr.appendChild(tdInfo);
                // ì½”ë“œ
                const tdCode = document.createElement('td');
                tdCode.style.textAlign = 'center';
                tdCode.textContent = r.restaurantCode;
                tr.appendChild(tdCode);

                tbody.appendChild(tr);
            });
        }

        function formatDate(dateStr) {
            const d = new Date(dateStr);
            const yyyy = d.getFullYear();
            const MM   = String(d.getMonth()+1).padStart(2,'0');
            const dd   = String(d.getDate()).padStart(2,'0');
            const hh   = String(d.getHours()).padStart(2,'0');
            const mm   = String(d.getMinutes()).padStart(2,'0');
            return `${yyyy}. ${MM}. ${dd}. ${hh}:${mm}`;
        }

        // ê¸°ì¡´ ìŠ¹ì¸/ë°˜ë ¤ í•¸ë“¤ëŸ¬
        function handleApprove(code) {
            fetch(`/admin/restaurants/${code}/approve`, { method: 'PATCH' })
                .then(r => r.ok ? loadPendingRestaurants(getCurrentSort()) : alert('ìŠ¹ì¸ ì‹¤íŒ¨'));
        }
        function handleReject(code) {
            fetch(`/admin/restaurants/${code}/reject`, { method: 'PATCH' })
                .then(r => r.ok ? loadPendingRestaurants(getCurrentSort()) : alert('ë°˜ë ¤ ì‹¤íŒ¨'));
        }

        // í˜„ì¬ ì²´í¬ëœ ì •ë ¬ ê¸°ì¤€ ë°˜í™˜
        function getCurrentSort() {
            if (document.getElementById('sortDate').checked) return 'date';
            if (document.getElementById('sortName').checked) return 'name';
            return null;
        }
    </script>
</body>
</html>